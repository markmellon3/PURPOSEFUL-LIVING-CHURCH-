<!DOCTYPE html>
<html lang="en">
<head>
  <header class="plc-header">
  <div class="plc-header-left">
    <span class="plc-logo">PLC</span>
    <div class="plc-title">
      <h1>PLC DASHBOARD</h1>
      <small>Admin Control Panel</small>
    </div>
  </div>

  <div class="plc-header-right">
    <span class="status-dot"></span>
    <span class="status-text">Online</span>
  </div>
</header>
<meta charset="UTF-8">
<title>PLC Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-auth-compat.js"></script>

<style>
  .plc-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: linear-gradient(135deg, #ff9800, #f57c00);
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 20px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.25);
}

/* Left section */
.plc-header-left {
  display: flex;
  align-items: center;
  gap: 14px;
}

.plc-logo {
  background: white;
  color: #f57c00;
  font-weight: bold;
  font-size: 20px;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.plc-title h1 {
  font-size: 18px;
  margin: 0;
  letter-spacing: 1px;
}

.plc-title small {
  font-size: 12px;
  opacity: 0.9;
}

/* Right section */
.plc-header-right {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}

.status-dot {
  width: 10px;
  height: 10px;
  background: #00ff5a;
  border-radius: 50%;
  box-shadow: 0 0 10px #00ff5a;
}

/* Mobile adjustments */
@media (max-width: 600px) {
  .plc-title h1 {
    font-size: 16px;
  }
  .plc-title small {
    display: none;
  }
}

body{
  margin:0;
  padding:15px;
  font-family:Arial,Helvetica,sans-serif;
  background:#f2f2f2;
}

.panel{
  max-width:1000px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.12);
}

h2{ color:#ff6600; margin-top:0; }
h3{ color:#ff6600; margin-bottom:5px; }

input, textarea, button{
  width:100%;
  padding:10px;
  margin-top:10px;
  box-sizing:border-box;
  font-size:16px;
}

textarea{ min-height:120px; }

button{
  background:#ff6600;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

button:hover{ background:#e65c00; }

hr{ margin:30px 0; }

.item{
  background:#fafafa;
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-bottom:15px;
}

.item img{
  width:100%;
  border-radius:8px;
}

.actions{
  margin-top:10px;
  display:flex;
  flex-wrap:wrap;
  gap:5px;
}

.actions button{
  width:auto;
  padding:6px 12px;
  font-size:14px;
}

.edit{ background:#007bff; color:#fff; }
.edit:hover{ background:#0056b3; }

.delete{ background:#dc3545; color:#fff; }
.delete:hover{ background:#a71d2a; }

@media(max-width:600px){
  body{ padding:10px; }
  .panel{ padding:15px; }
  .actions button{ flex:1 1 100%; }
}

#newsList, #eventList, #mediaList, #kidsGalleryList{
  max-height:500px;
  overflow-y:auto;
  padding-right:5px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="panel" id="loginPanel">
  <h2>Admin Login</h2>
  <input type="email" id="email" placeholder="Admin Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- ADMIN DASHBOARD -->
<div class="panel" id="adminPanel" style="display:none;">
  
  <hr>

<h2>Upload Image (Fast Public Link Generator)</h2>

<input type="file" id="imageFile" accept="image/*" onchange="previewImage()">

<br><br>
<img id="preview" style="max-width:200px; display:none; border-radius:10px;">

<br><br>
<button onclick="uploadImage()">Upload & Generate Link</button>
<span id="spinner" style="display:none;">‚è≥ Uploading...</span>

<br><br>
<input id="generatedLink" readonly placeholder="Public image URL will appear here" style="width:100%;">

<br><br>
<button onclick="pasteLink()">Paste Link</button>

  <hr>
  <h2>Live Website Preview</h2>
  <p>You can see your website changes in real-time here:</p>
  <button onclick="refreshPreview()">Refresh Preview</button>
  <div style="margin-top:10px; border:1px solid #ccc; border-radius:8px; overflow:hidden;">
    <iframe id="livePreview" src="https://purposefullivingchurchplc.org/" style="width:100%; height:600px; border:none;"></iframe>
  </div>

  <hr>
  <h2>Add / Edit News</h2>
  <input type="hidden" id="newsId">
  <input id="title" placeholder="News Title">
  <input type="date" id="date">
  <textarea id="content" placeholder="News Content"></textarea>
  <button onclick="saveNews()">Save News</button>

  <h3>All News (Recent & Old)</h3>
  <div id="newsList"></div>

  <hr>
  <h2>Add Event Image</h2>
  <input id="imageUrl" placeholder="Image URL">
  <button onclick="addEvent()">Add Event Image</button>

  <h3>Manage Event Images</h3>
  <div id="eventList"></div>

  <hr>
  <h2>Manage Media Images</h2>
  <h3>Add Media Image</h3>
  <input id="mediaUrl" placeholder="Media Image URL">
  <button onclick="addMediaImage()">Add Media Image</button>

  <h3>All Media Images</h3>
  <div id="mediaList"></div>

  <hr>
  <h2>Manage Kids Gallery</h2>
  <h3>Add Kids Image</h3>
  <input type="text" id="kidsCaption" placeholder="Image caption (optional)">
  <input type="url" id="kidsImageUrl" placeholder="Kids Image URL">
  <button onclick="addKidsImage()">Add Kids Image</button>

  <h3>All Kids Images</h3>
  <div id="kidsGalleryList"></div>

</div>

<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyDaFhZ_ykNSmNXKCh6ye1M1vgoW6VhrdLU",
  authDomain: "plc-church.firebaseapp.com",
  databaseURL: "https://plc-church-default-rtdb.firebaseio.com",
  projectId: "plc-church"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

/* ---------- AUTH ---------- */
function login(){
  auth.signInWithEmailAndPassword(email.value, password.value)
    .then(() => {
      loginPanel.style.display = "none";
      adminPanel.style.display = "block";
      loadNews();
      loadEvents();
      loadMediaImages();
      loadKidsGallery();
    })
    .catch(err => alert(err.message));
}

/* ---------- NEWS CRUD ---------- */
function saveNews(){
  const data = {
    title: title.value || "",
    date: date.value || "",
    content: content.value || ""
  };

  if(newsId.value){
    db.ref("news/" + newsId.value).update(data);
  } else {
    data.views = 0;
    db.ref("news").push(data);
  }

  newsId.value = "";
  title.value = "";
  date.value = "";
  content.value = "";
}

function loadNews(){
  db.ref("news").on("value", snap => {
    const list = document.getElementById("newsList");
    list.innerHTML = "";

    const newsArray = [];
    snap.forEach(child => {
      const n = { id: child.key, ...child.val() };
      n.timestamp = n.date ? new Date(n.date).getTime() : 0;
      newsArray.push(n);
    });

    newsArray.sort((a,b) => b.timestamp - a.timestamp);

    newsArray.forEach(n=>{
      list.innerHTML += `
        <div class="item">
          <strong>${n.title || "Untitled News"}</strong><br>
          <small>${n.date || "No date"} ‚Ä¢ üëÅ ${n.views || 0} views</small>
          <p>${n.content || ""}</p>
          <div class="actions">
            <button class="edit"
              onclick="editNews('${n.id}','${(n.title||"").replace(/'/g,"\\'")}','${n.date||""}','${(n.content||"").replace(/'/g,"\\'")}')">Edit</button>
            <button class="delete"
              onclick="deleteNews('${n.id}')">Delete</button>
          </div>
        </div>`;
    });
  });
}

function editNews(id, t, d, c){
  newsId.value = id;
  title.value = t;
  date.value = d;
  content.value = c;
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function deleteNews(id){
  if(confirm("Delete this news?")){
    db.ref("news/" + id).remove();
  }
}

/* ---------- EVENTS CRUD ---------- */
function addEvent(){
  if(!imageUrl.value) return;
  db.ref("events").push({ imageUrl: imageUrl.value });
  imageUrl.value = "";
}

function loadEvents(){
  db.ref("events").on("value", snap => {
    const list = document.getElementById("eventList");
    list.innerHTML = "";
    snap.forEach(c=>{
      list.innerHTML += `
        <div class="item">
          <img src="${c.val().imageUrl}">
          <div class="actions">
            <button class="edit" onclick="editEvent('${c.key}','${c.val().imageUrl}')">Edit</button>
            <button class="delete" onclick="deleteEvent('${c.key}')">Delete</button>
          </div>
        </div>`;
    });
  });
}

function editEvent(id, url){
  const newUrl = prompt("Update image URL", url);
  if(newUrl){
    db.ref("events/" + id).update({ imageUrl: newUrl });
  }
}

function deleteEvent(id){
  if(confirm("Delete this event image?")){
    db.ref("events/" + id).remove();
  }
}

/* ---------- MEDIA IMAGES CRUD ---------- */
function addMediaImage(){
  if(!mediaUrl.value) return;
  db.ref("gallery").push({ url: mediaUrl.value });
  mediaUrl.value = "";
}

function loadMediaImages(){
  db.ref("gallery").on("value", snap => {
    const list = document.getElementById("mediaList");
    list.innerHTML = "";
    snap.forEach(c=>{
      list.innerHTML += `
        <div class="item">
          <img src="${c.val().url}">
          <div class="actions">
            <button class="edit" onclick="editMedia('${c.key}','${c.val().url}')">Edit</button>
            <button class="delete" onclick="deleteMedia('${c.key}')">Delete</button>
          </div>
        </div>`;
    });
  });
}

function editMedia(id, url){
  const newUrl = prompt("Update media image URL", url);
  if(newUrl){
    db.ref("gallery/" + id).update({ url: newUrl });
  }
}

function deleteMedia(id){
  if(confirm("Delete this media image?")){
    db.ref("gallery/" + id).remove();
  }
}

/* ---------- KIDS GALLERY CRUD ---------- */
const kidsGalleryRef = db.ref("kidsGallery");

function addKidsImage() {
  const url = document.getElementById("kidsImageUrl").value.trim();
  const caption = document.getElementById("kidsCaption").value.trim();
  if(!url) return alert("Please enter an image URL");
  kidsGalleryRef.push({ url, caption: caption || "", timestamp: Date.now() });
  document.getElementById("kidsImageUrl").value = "";
  document.getElementById("kidsCaption").value = "";
}

function loadKidsGallery() {
  const list = document.getElementById("kidsGalleryList");
  list.innerHTML = "";
  kidsGalleryRef.on("value", snapshot => {
    list.innerHTML = "";
    snapshot.forEach(child => {
      const data = child.val();
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <img src="${data.url}" alt="${data.caption}">
        <p>${data.caption || ""}</p>
        <div class="actions">
          <button class="edit" onclick="editKidsImage('${child.key}','${data.url}','${(data.caption||"").replace(/'/g,"\\'")}')">Edit</button>
          <button class="delete" onclick="deleteKidsImage('${child.key}')">Delete</button>
        </div>
      `;
      list.appendChild(div);
    });
  });
}

function editKidsImage(id, url, caption){
  const newUrl = prompt("Update image URL", url);
  const newCaption = prompt("Update caption (optional)", caption);
  if(newUrl){
    kidsGalleryRef.child(id).update({ url: newUrl, caption: newCaption || "" });
  }
}

function deleteKidsImage(id){
  if(confirm("Delete this kids image?")){
    kidsGalleryRef.child(id).remove();
  }
}

/* ---------- LIVE PREVIEW ---------- */
function refreshPreview(){
  const iframe = document.getElementById('livePreview');
  iframe.src = iframe.src;
}

// Optional: auto-refresh every 60s
setInterval(refreshPreview, 60000);
</script>
<script>
const IMGBB_API_KEY = "47f7dff148164ff31a5947e6ee635363";

/* Preview image instantly */
function previewImage() {
  const file = document.getElementById("imageFile").files[0];
  const preview = document.getElementById("preview");

  if (!file) return;

  preview.src = URL.createObjectURL(file);
  preview.style.display = "block";
}

/* Compress image (FASTER UPLOAD) */
function compressImage(file, quality = 0.7) {
  return new Promise(resolve => {
    const img = new Image();
    const reader = new FileReader();

    reader.onload = e => {
      img.src = e.target.result;
    };

    img.onload = () => {
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");

      const maxWidth = 1200;
      const scale = Math.min(maxWidth / img.width, 1);

      canvas.width = img.width * scale;
      canvas.height = img.height * scale;

      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      canvas.toBlob(blob => resolve(blob), "image/jpeg", quality);
    };

    reader.readAsDataURL(file);
  });
}

/* Upload image */
async function uploadImage() {
  const fileInput = document.getElementById("imageFile");
  const linkInput = document.getElementById("generatedLink");
  const spinner = document.getElementById("spinner");

  const file = fileInput.files[0];
  if (!file) return alert("Select an image");

  spinner.style.display = "inline";
  linkInput.value = "Uploading...";

  try {
    const compressed = await compressImage(file);

    const formData = new FormData();
    formData.append("image", compressed);

    const res = await fetch(
      `https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`,
      { method: "POST", body: formData }
    );

    const data = await res.json();
    if (!data.success) throw new Error("Upload failed");

    const url = data.data.url;

    linkInput.value = url;
    linkInput.select();
    document.execCommand("copy");

    // Auto clear input
    fileInput.value = "";
    document.getElementById("preview").style.display = "none";

  } catch (e) {
    alert("Upload error");
    console.error(e);
    linkInput.value = "";
  }

  spinner.style.display = "none";
}

/* Paste copied link anywhere */
async function pasteLink() {
  const text = await navigator.clipboard.readText();
  alert("Copied link:\n" + text);
}
</script>
</body>
</html>
