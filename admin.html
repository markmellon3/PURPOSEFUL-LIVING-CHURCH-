<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PLC Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-auth-compat.js"></script>

<style>
body{
  margin:0;
  padding:15px;
  font-family:Arial,Helvetica,sans-serif;
  background:#f2f2f2;
}

.panel{
  max-width:900px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.12);
}

h2{ color:#ff6600; margin-top:0; }

input, textarea, button{
  width:100%;
  padding:10px;
  margin-top:10px;
  box-sizing:border-box;
  font-size:16px;
}

textarea{ min-height:120px; }

button{
  background:#ff6600;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

button:hover{ background:#e65c00; }

hr{ margin:30px 0; }

.item{
  background:#fafafa;
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-bottom:15px;
}

.item img{
  width:100%;
  border-radius:8px;
}

.actions{
  margin-top:10px;
}

.actions button{
  width:auto;
  padding:6px 12px;
  margin-right:5px;
  font-size:14px;
}

.edit{ background:#007bff; }
.edit:hover{ background:#0056b3; }

.delete{ background:#dc3545; }
.delete:hover{ background:#a71d2a; }

@media(max-width:600px){
  body{ padding:10px; }
  .panel{ padding:15px; }
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="panel" id="loginPanel">
  <h2>Admin Login</h2>
  <input type="email" id="email" placeholder="Admin Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- ADMIN DASHBOARD -->
<div class="panel" id="adminPanel" style="display:none;">

  <h2>Add / Edit News</h2>
  <input type="hidden" id="newsId">
  <input id="title" placeholder="News Title">
  <input type="date" id="date">
  <textarea id="content" placeholder="News Content"></textarea>
  <button onclick="saveNews()">Save News</button>

  <hr>

  <h2>All News (Recent & Old)</h2>
  <div id="newsList"></div>

  <hr>

  <h2>Add Event Image</h2>
  <input id="imageUrl" placeholder="Image URL">
  <button onclick="addEvent()">Add Event Image</button>

  <hr>

  <h2>Manage Event Images</h2>
  <div id="eventList"></div>

</div>

<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyDaFhZ_ykNSmNXKCh6ye1M1vgoW6VhrdLU",
  authDomain: "plc-church.firebaseapp.com",
  databaseURL: "https://plc-church-default-rtdb.firebaseio.com",
  projectId: "plc-church"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

/* ---------- AUTH ---------- */
function login(){
  auth.signInWithEmailAndPassword(email.value, password.value)
    .then(() => {
      loginPanel.style.display = "none";
      adminPanel.style.display = "block";
      loadNews();
      loadEvents();
    })
    .catch(err => alert(err.message));
}

/* ---------- NEWS CRUD (FIXED: SHOW ALL NEWS) ---------- */
function saveNews(){
  const data = {
    title: title.value || "",
    date: date.value || "",
    content: content.value || ""
  };

  if(newsId.value){
    db.ref("news/" + newsId.value).update(data);
  } else {
    data.views = 0;
    db.ref("news").push(data);
    // üîî Push notification hook can be added here
  }

  newsId.value = "";
  title.value = "";
  date.value = "";
  content.value = "";
}

function loadNews(){
  db.ref("news").on("value", snap => {
    const list = document.getElementById("newsList");
    list.innerHTML = "";

    const newsArray = [];

    snap.forEach(child => {
      newsArray.push({
        id: child.key,
        ...child.val()
      });
    });

    // Sort newest first (safe for missing dates)
    newsArray.sort((a, b) => {
      if (!a.date) return 1;
      if (!b.date) return -1;
      return b.date.localeCompare(a.date);
    });

    newsArray.forEach(n => {
      list.innerHTML += `
        <div class="item">
          <strong>${n.title || "Untitled News"}</strong><br>
          <small>${n.date || "No date"} ‚Ä¢ üëÅ ${n.views || 0} views</small>
          <p>${n.content || ""}</p>
          <div class="actions">
            <button class="edit"
              onclick="editNews(
                '${n.id}',
                '${(n.title||"").replace(/'/g,"\\'")}',
                '${n.date||""}',
                '${(n.content||"").replace(/'/g,"\\'")}'
              )">Edit</button>

            <button class="delete"
              onclick="deleteNews('${n.id}')">Delete</button>
          </div>
        </div>`;
    });
  });
}

function editNews(id, t, d, c){
  newsId.value = id;
  title.value = t;
  date.value = d;
  content.value = c;
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function deleteNews(id){
  if(confirm("Delete this news?")){
    db.ref("news/" + id).remove();
  }
}

/* ---------- EVENTS CRUD ---------- */
function addEvent(){
  if(!imageUrl.value) return;
  db.ref("events").push({ imageUrl: imageUrl.value });
  imageUrl.value = "";
}

function loadEvents(){
  db.ref("events").on("value", snap => {
    const list = document.getElementById("eventList");
    list.innerHTML = "";
    snap.forEach(c => {
      list.innerHTML += `
        <div class="item">
          <img src="${c.val().imageUrl}">
          <div class="actions">
            <button class="edit"
              onclick="editEvent('${c.key}','${c.val().imageUrl}')">Edit</button>
            <button class="delete"
              onclick="deleteEvent('${c.key}')">Delete</button>
          </div>
        </div>`;
    });
  });
}

function editEvent(id, url){
  const newUrl = prompt("Update image URL", url);
  if(newUrl){
    db.ref("events/" + id).update({ imageUrl: newUrl });
  }
}

function deleteEvent(id){
  if(confirm("Delete this event image?")){
    db.ref("events/" + id).remove();
  }
}
</script>
<script>
/* ================= DYNAMIC BACKGROUND IMAGE ================= */

// URL of your background image
const backgroundImageUrl = "https://ik.imagekit.io/s95tumxuk/PLC/1763336127446.jpg";

// Create a full-screen background div
const bgDiv = document.createElement("div");
bgDiv.style.position = "fixed";
bgDiv.style.top = "0";
bgDiv.style.left = "0";
bgDiv.style.width = "100%";
bgDiv.style.height = "100%";
bgDiv.style.zIndex = "-1"; // Send it behind all content
bgDiv.style.backgroundImage = `url('${backgroundImageUrl}')`;
bgDiv.style.backgroundSize = "cover";
bgDiv.style.backgroundPosition = "center";
bgDiv.style.backgroundRepeat = "no-repeat";
bgDiv.style.transition = "opacity 0.5s ease"; // smooth fade effect
document.body.appendChild(bgDiv);

/* ================= OPTIONAL: CHANGE BACKGROUND DYNAMICALLY ================= */
/*
const images = [
  "https://example.com/image1.jpg",
  "https://example.com/image2.jpg",
  "https://example.com/image3.jpg"
];
let current = 0;

setInterval(() => {
  current = (current + 1) % images.length;
  bgDiv.style.opacity = 0;
  setTimeout(() => {
    bgDiv.style.backgroundImage = `url('${images[current]}')`;
    bgDiv.style.opacity = 1;
  }, 500); // fade transition
}, 10000); // change every 10 seconds
*/
</script>
</body>
</html>
